var dt=Object.create;var j=Object.defineProperty;var lt=Object.getOwnPropertyDescriptor;var ut=Object.getOwnPropertyNames;var xt=Object.getPrototypeOf,pt=Object.prototype.hasOwnProperty;var m=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),bt=(e,t)=>{for(var i in t)j(e,i,{get:t[i],enumerable:!0})},me=(e,t,i,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of ut(t))!pt.call(e,r)&&r!==i&&j(e,r,{get:()=>t[r],enumerable:!(s=lt(t,r))||s.enumerable});return e};var _t=(e,t,i)=>(i=e!=null?dt(xt(e)):{},me(t||!e||!e.__esModule?j(i,"default",{value:e,enumerable:!0}):i,e)),yt=e=>me(j({},"__esModule",{value:!0}),e);var ne=m((xi,Fe)=>{"use strict";var{EventEmitter:Et}=require("node:events"),{inherits:Ct}=require("node:util");function B(e){if(typeof e=="string"&&(e=Buffer.from(e)),!Buffer.isBuffer(e))throw new TypeError("The needle has to be a String or a Buffer.");let t=e.length,i=t-1;if(t===0)throw new Error("The needle cannot be an empty String/Buffer.");if(t>256)throw new Error("The needle cannot have a length bigger than 256.");this.maxMatches=1/0,this.matches=0,this._occ=new Uint8Array(256).fill(t),this._lookbehind_size=0,this._needle=e,this._bufpos=0,this._lookbehind=Buffer.alloc(i);for(var s=0;s<i;++s)this._occ[e[s]]=i-s}Ct(B,Et);B.prototype.reset=function(){this._lookbehind_size=0,this.matches=0,this._bufpos=0};B.prototype.push=function(e,t){Buffer.isBuffer(e)||(e=Buffer.from(e,"binary"));let i=e.length;this._bufpos=t||0;let s;for(;s!==i&&this.matches<this.maxMatches;)s=this._sbmh_feed(e);return s};B.prototype._sbmh_feed=function(e){let t=e.length,i=this._needle,s=i.length,r=s-1,n=i[r],o=-this._lookbehind_size,a;if(o<0){for(;o<0&&o<=t-s;){if(a=e[o+r],a===n&&this._sbmh_memcmp(e,o,r))return this._lookbehind_size=0,++this.matches,this.emit("info",!0),this._bufpos=o+s;o+=this._occ[a]}for(;o<0&&!this._sbmh_memcmp(e,o,t-o);)++o;if(o>=0)this.emit("info",!1,this._lookbehind,0,this._lookbehind_size),this._lookbehind_size=0;else{let f=this._lookbehind_size+o;return f>0&&this.emit("info",!1,this._lookbehind,0,f),this._lookbehind_size-=f,this._lookbehind.copy(this._lookbehind,0,f,this._lookbehind_size),e.copy(this._lookbehind,this._lookbehind_size),this._lookbehind_size+=t,this._bufpos=t,t}}if(o=e.indexOf(i,o+this._bufpos),o!==-1)return++this.matches,o===0?this.emit("info",!0):this.emit("info",!0,e,this._bufpos,o),this._bufpos=o+s;for(o=t-r,o<0&&(o=0);o!==t&&(e[o]!==i[0]||Buffer.compare(e.subarray(o+1,t),i.subarray(1,t-o))!==0);)++o;return o!==t&&(e.copy(this._lookbehind,0,o,t),this._lookbehind_size=t-o),o!==0&&this.emit("info",!1,e,this._bufpos,o),this._bufpos=t,t};B.prototype._sbmh_lookup_char=function(e,t){return t<0?this._lookbehind[this._lookbehind_size+t]:e[t]};B.prototype._sbmh_memcmp=function(e,t,i){for(var s=0;s<i;++s)if(this._sbmh_lookup_char(e,t+s)!==this._needle[s])return!1;return!0};Fe.exports=B});var De=m((pi,Se)=>{"use strict";var At=require("node:util").inherits,Pe=require("node:stream").Readable;function oe(e){Pe.call(this,e)}At(oe,Pe);oe.prototype._read=function(e){};Se.exports=oe});var K=m((bi,Te)=>{"use strict";Te.exports=function(t,i,s){if(!t||t[i]===void 0||t[i]===null)return s;if(typeof t[i]!="number"||isNaN(t[i]))throw new TypeError("Limit "+i+" is not a valid number");return t[i]}});var Me=m((_i,ve)=>{"use strict";var Re=require("node:events").EventEmitter,Bt=require("node:util").inherits,Le=K(),kt=ne(),Ft=Buffer.from(`\r
\r
`),Pt=/\r\n/g,St=/^([^:]+):[ \t]?([\x00-\xFF]+)?$/;function D(e){Re.call(this),e=e||{};let t=this;this.nread=0,this.maxed=!1,this.npairs=0,this.maxHeaderPairs=Le(e,"maxHeaderPairs",2e3),this.maxHeaderSize=Le(e,"maxHeaderSize",80*1024),this.buffer="",this.header={},this.finished=!1,this.ss=new kt(Ft),this.ss.on("info",function(i,s,r,n){s&&!t.maxed&&(t.nread+n-r>=t.maxHeaderSize?(n=t.maxHeaderSize-t.nread+r,t.nread=t.maxHeaderSize,t.maxed=!0):t.nread+=n-r,t.buffer+=s.toString("binary",r,n)),i&&t._finish()})}Bt(D,Re);D.prototype.push=function(e){let t=this.ss.push(e);if(this.finished)return t};D.prototype.reset=function(){this.finished=!1,this.buffer="",this.header={},this.ss.reset()};D.prototype._finish=function(){this.buffer&&this._parseHeader(),this.ss.matches=this.ss.maxMatches;let e=this.header;this.header={},this.buffer="",this.finished=!0,this.nread=this.npairs=0,this.maxed=!1,this.emit("header",e)};D.prototype._parseHeader=function(){if(this.npairs===this.maxHeaderPairs)return;let e=this.buffer.split(Pt),t=e.length,i,s;for(var r=0;r<t;++r){if(e[r].length===0)continue;if((e[r][0]==="	"||e[r][0]===" ")&&s){this.header[s][this.header[s].length-1]+=e[r];continue}let n=e[r].indexOf(":");if(n===-1||n===0)return;if(i=St.exec(e[r]),s=i[1].toLowerCase(),this.header[s]=this.header[s]||[],this.header[s].push(i[2]||""),++this.npairs===this.maxHeaderPairs)break}};ve.exports=D});var fe=m((yi,He)=>{"use strict";var ae=require("node:stream").Writable,Dt=require("node:util").inherits,Tt=ne(),ze=De(),Lt=Me(),Rt=45,vt=Buffer.from("-"),Mt=Buffer.from(`\r
`),zt=function(){};function g(e){if(!(this instanceof g))return new g(e);if(ae.call(this,e),!e||!e.headerFirst&&typeof e.boundary!="string")throw new TypeError("Boundary required");typeof e.boundary=="string"?this.setBoundary(e.boundary):this._bparser=void 0,this._headerFirst=e.headerFirst,this._dashes=0,this._parts=0,this._finished=!1,this._realFinish=!1,this._isPreamble=!0,this._justMatched=!1,this._firstWrite=!0,this._inHeader=!0,this._part=void 0,this._cb=void 0,this._ignoreData=!1,this._partOpts={highWaterMark:e.partHwm},this._pause=!1;let t=this;this._hparser=new Lt(e),this._hparser.on("header",function(i){t._inHeader=!1,t._part.emit("header",i)})}Dt(g,ae);g.prototype.emit=function(e){if(e==="finish"&&!this._realFinish){if(!this._finished){let t=this;process.nextTick(function(){if(t.emit("error",new Error("Unexpected end of multipart data")),t._part&&!t._ignoreData){let i=t._isPreamble?"Preamble":"Part";t._part.emit("error",new Error(i+" terminated early due to unexpected end of multipart data")),t._part.push(null),process.nextTick(function(){t._realFinish=!0,t.emit("finish"),t._realFinish=!1});return}t._realFinish=!0,t.emit("finish"),t._realFinish=!1})}}else ae.prototype.emit.apply(this,arguments)};g.prototype._write=function(e,t,i){if(!this._hparser&&!this._bparser)return i();if(this._headerFirst&&this._isPreamble){this._part||(this._part=new ze(this._partOpts),this.listenerCount("preamble")!==0?this.emit("preamble",this._part):this._ignore());let s=this._hparser.push(e);if(!this._inHeader&&s!==void 0&&s<e.length)e=e.slice(s);else return i()}this._firstWrite&&(this._bparser.push(Mt),this._firstWrite=!1),this._bparser.push(e),this._pause?this._cb=i:i()};g.prototype.reset=function(){this._part=void 0,this._bparser=void 0,this._hparser=void 0};g.prototype.setBoundary=function(e){let t=this;this._bparser=new Tt(`\r
--`+e),this._bparser.on("info",function(i,s,r,n){t._oninfo(i,s,r,n)})};g.prototype._ignore=function(){this._part&&!this._ignoreData&&(this._ignoreData=!0,this._part.on("error",zt),this._part.resume())};g.prototype._oninfo=function(e,t,i,s){let r,n=this,o=0,a,f=!0;if(!this._part&&this._justMatched&&t){for(;this._dashes<2&&i+o<s;)if(t[i+o]===Rt)++o,++this._dashes;else{this._dashes&&(r=vt),this._dashes=0;break}if(this._dashes===2&&(i+o<s&&this.listenerCount("trailer")!==0&&this.emit("trailer",t.slice(i+o,s)),this.reset(),this._finished=!0,n._parts===0&&(n._realFinish=!0,n.emit("finish"),n._realFinish=!1)),this._dashes)return}this._justMatched&&(this._justMatched=!1),this._part||(this._part=new ze(this._partOpts),this._part._read=function(c){n._unpause()},this._isPreamble&&this.listenerCount("preamble")!==0?this.emit("preamble",this._part):this._isPreamble!==!0&&this.listenerCount("part")!==0?this.emit("part",this._part):this._ignore(),this._isPreamble||(this._inHeader=!0)),t&&i<s&&!this._ignoreData&&(this._isPreamble||!this._inHeader?(r&&(f=this._part.push(r)),f=this._part.push(t.slice(i,s)),f||(this._pause=!0)):!this._isPreamble&&this._inHeader&&(r&&this._hparser.push(r),a=this._hparser.push(t.slice(i,s)),!this._inHeader&&a!==void 0&&a<s&&this._oninfo(!1,t,i+a,s))),e&&(this._hparser.reset(),this._isPreamble?this._isPreamble=!1:i!==s&&(++this._parts,this._part.on("end",function(){--n._parts===0&&(n._finished?(n._realFinish=!0,n.emit("finish"),n._realFinish=!1):n._unpause())})),this._part.push(null),this._part=void 0,this._ignoreData=!1,this._justMatched=!0,this._dashes=0)};g.prototype._unpause=function(){if(this._pause&&(this._pause=!1,this._cb)){let e=this._cb;this._cb=void 0,e()}};He.exports=g});var $=m((ce,Ne)=>{"use strict";var Ie=new TextDecoder("utf-8"),Oe=new Map([["utf-8",Ie],["utf8",Ie]]);function Ht(e){let t;for(;;)switch(e){case"utf-8":case"utf8":return z.utf8;case"latin1":case"ascii":case"us-ascii":case"iso-8859-1":case"iso8859-1":case"iso88591":case"iso_8859-1":case"windows-1252":case"iso_8859-1:1987":case"cp1252":case"x-cp1252":return z.latin1;case"utf16le":case"utf-16le":case"ucs2":case"ucs-2":return z.utf16le;case"base64":return z.base64;default:if(t===void 0){t=!0,e=e.toLowerCase();continue}return z.other.bind(e)}}var z={utf8:(e,t)=>e.length===0?"":(typeof e=="string"&&(e=Buffer.from(e,t)),e.utf8Slice(0,e.length)),latin1:(e,t)=>e.length===0?"":typeof e=="string"?e:e.latin1Slice(0,e.length),utf16le:(e,t)=>e.length===0?"":(typeof e=="string"&&(e=Buffer.from(e,t)),e.ucs2Slice(0,e.length)),base64:(e,t)=>e.length===0?"":(typeof e=="string"&&(e=Buffer.from(e,t)),e.base64Slice(0,e.length)),other:(e,t)=>{if(e.length===0)return"";if(typeof e=="string"&&(e=Buffer.from(e,t)),Oe.has(ce.toString()))try{return Oe.get(ce).decode(e)}catch{}return typeof e=="string"?e:e.toString()}};function It(e,t,i){return e&&Ht(i)(e,t)}Ne.exports=It});var de=m((mi,Ke)=>{"use strict";var G=$(),qe=/%[a-fA-F0-9][a-fA-F0-9]/g,Ot={"%00":"\0","%01":"","%02":"","%03":"","%04":"","%05":"","%06":"","%07":"\x07","%08":"\b","%09":"	","%0a":`
`,"%0A":`
`,"%0b":"\v","%0B":"\v","%0c":"\f","%0C":"\f","%0d":"\r","%0D":"\r","%0e":"","%0E":"","%0f":"","%0F":"","%10":"","%11":"","%12":"","%13":"","%14":"","%15":"","%16":"","%17":"","%18":"","%19":"","%1a":"","%1A":"","%1b":"\x1B","%1B":"\x1B","%1c":"","%1C":"","%1d":"","%1D":"","%1e":"","%1E":"","%1f":"","%1F":"","%20":" ","%21":"!","%22":'"',"%23":"#","%24":"$","%25":"%","%26":"&","%27":"'","%28":"(","%29":")","%2a":"*","%2A":"*","%2b":"+","%2B":"+","%2c":",","%2C":",","%2d":"-","%2D":"-","%2e":".","%2E":".","%2f":"/","%2F":"/","%30":"0","%31":"1","%32":"2","%33":"3","%34":"4","%35":"5","%36":"6","%37":"7","%38":"8","%39":"9","%3a":":","%3A":":","%3b":";","%3B":";","%3c":"<","%3C":"<","%3d":"=","%3D":"=","%3e":">","%3E":">","%3f":"?","%3F":"?","%40":"@","%41":"A","%42":"B","%43":"C","%44":"D","%45":"E","%46":"F","%47":"G","%48":"H","%49":"I","%4a":"J","%4A":"J","%4b":"K","%4B":"K","%4c":"L","%4C":"L","%4d":"M","%4D":"M","%4e":"N","%4E":"N","%4f":"O","%4F":"O","%50":"P","%51":"Q","%52":"R","%53":"S","%54":"T","%55":"U","%56":"V","%57":"W","%58":"X","%59":"Y","%5a":"Z","%5A":"Z","%5b":"[","%5B":"[","%5c":"\\","%5C":"\\","%5d":"]","%5D":"]","%5e":"^","%5E":"^","%5f":"_","%5F":"_","%60":"`","%61":"a","%62":"b","%63":"c","%64":"d","%65":"e","%66":"f","%67":"g","%68":"h","%69":"i","%6a":"j","%6A":"j","%6b":"k","%6B":"k","%6c":"l","%6C":"l","%6d":"m","%6D":"m","%6e":"n","%6E":"n","%6f":"o","%6F":"o","%70":"p","%71":"q","%72":"r","%73":"s","%74":"t","%75":"u","%76":"v","%77":"w","%78":"x","%79":"y","%7a":"z","%7A":"z","%7b":"{","%7B":"{","%7c":"|","%7C":"|","%7d":"}","%7D":"}","%7e":"~","%7E":"~","%7f":"\x7F","%7F":"\x7F","%80":"\x80","%81":"\x81","%82":"\x82","%83":"\x83","%84":"\x84","%85":"\x85","%86":"\x86","%87":"\x87","%88":"\x88","%89":"\x89","%8a":"\x8A","%8A":"\x8A","%8b":"\x8B","%8B":"\x8B","%8c":"\x8C","%8C":"\x8C","%8d":"\x8D","%8D":"\x8D","%8e":"\x8E","%8E":"\x8E","%8f":"\x8F","%8F":"\x8F","%90":"\x90","%91":"\x91","%92":"\x92","%93":"\x93","%94":"\x94","%95":"\x95","%96":"\x96","%97":"\x97","%98":"\x98","%99":"\x99","%9a":"\x9A","%9A":"\x9A","%9b":"\x9B","%9B":"\x9B","%9c":"\x9C","%9C":"\x9C","%9d":"\x9D","%9D":"\x9D","%9e":"\x9E","%9E":"\x9E","%9f":"\x9F","%9F":"\x9F","%a0":"\xA0","%A0":"\xA0","%a1":"\xA1","%A1":"\xA1","%a2":"\xA2","%A2":"\xA2","%a3":"\xA3","%A3":"\xA3","%a4":"\xA4","%A4":"\xA4","%a5":"\xA5","%A5":"\xA5","%a6":"\xA6","%A6":"\xA6","%a7":"\xA7","%A7":"\xA7","%a8":"\xA8","%A8":"\xA8","%a9":"\xA9","%A9":"\xA9","%aa":"\xAA","%Aa":"\xAA","%aA":"\xAA","%AA":"\xAA","%ab":"\xAB","%Ab":"\xAB","%aB":"\xAB","%AB":"\xAB","%ac":"\xAC","%Ac":"\xAC","%aC":"\xAC","%AC":"\xAC","%ad":"\xAD","%Ad":"\xAD","%aD":"\xAD","%AD":"\xAD","%ae":"\xAE","%Ae":"\xAE","%aE":"\xAE","%AE":"\xAE","%af":"\xAF","%Af":"\xAF","%aF":"\xAF","%AF":"\xAF","%b0":"\xB0","%B0":"\xB0","%b1":"\xB1","%B1":"\xB1","%b2":"\xB2","%B2":"\xB2","%b3":"\xB3","%B3":"\xB3","%b4":"\xB4","%B4":"\xB4","%b5":"\xB5","%B5":"\xB5","%b6":"\xB6","%B6":"\xB6","%b7":"\xB7","%B7":"\xB7","%b8":"\xB8","%B8":"\xB8","%b9":"\xB9","%B9":"\xB9","%ba":"\xBA","%Ba":"\xBA","%bA":"\xBA","%BA":"\xBA","%bb":"\xBB","%Bb":"\xBB","%bB":"\xBB","%BB":"\xBB","%bc":"\xBC","%Bc":"\xBC","%bC":"\xBC","%BC":"\xBC","%bd":"\xBD","%Bd":"\xBD","%bD":"\xBD","%BD":"\xBD","%be":"\xBE","%Be":"\xBE","%bE":"\xBE","%BE":"\xBE","%bf":"\xBF","%Bf":"\xBF","%bF":"\xBF","%BF":"\xBF","%c0":"\xC0","%C0":"\xC0","%c1":"\xC1","%C1":"\xC1","%c2":"\xC2","%C2":"\xC2","%c3":"\xC3","%C3":"\xC3","%c4":"\xC4","%C4":"\xC4","%c5":"\xC5","%C5":"\xC5","%c6":"\xC6","%C6":"\xC6","%c7":"\xC7","%C7":"\xC7","%c8":"\xC8","%C8":"\xC8","%c9":"\xC9","%C9":"\xC9","%ca":"\xCA","%Ca":"\xCA","%cA":"\xCA","%CA":"\xCA","%cb":"\xCB","%Cb":"\xCB","%cB":"\xCB","%CB":"\xCB","%cc":"\xCC","%Cc":"\xCC","%cC":"\xCC","%CC":"\xCC","%cd":"\xCD","%Cd":"\xCD","%cD":"\xCD","%CD":"\xCD","%ce":"\xCE","%Ce":"\xCE","%cE":"\xCE","%CE":"\xCE","%cf":"\xCF","%Cf":"\xCF","%cF":"\xCF","%CF":"\xCF","%d0":"\xD0","%D0":"\xD0","%d1":"\xD1","%D1":"\xD1","%d2":"\xD2","%D2":"\xD2","%d3":"\xD3","%D3":"\xD3","%d4":"\xD4","%D4":"\xD4","%d5":"\xD5","%D5":"\xD5","%d6":"\xD6","%D6":"\xD6","%d7":"\xD7","%D7":"\xD7","%d8":"\xD8","%D8":"\xD8","%d9":"\xD9","%D9":"\xD9","%da":"\xDA","%Da":"\xDA","%dA":"\xDA","%DA":"\xDA","%db":"\xDB","%Db":"\xDB","%dB":"\xDB","%DB":"\xDB","%dc":"\xDC","%Dc":"\xDC","%dC":"\xDC","%DC":"\xDC","%dd":"\xDD","%Dd":"\xDD","%dD":"\xDD","%DD":"\xDD","%de":"\xDE","%De":"\xDE","%dE":"\xDE","%DE":"\xDE","%df":"\xDF","%Df":"\xDF","%dF":"\xDF","%DF":"\xDF","%e0":"\xE0","%E0":"\xE0","%e1":"\xE1","%E1":"\xE1","%e2":"\xE2","%E2":"\xE2","%e3":"\xE3","%E3":"\xE3","%e4":"\xE4","%E4":"\xE4","%e5":"\xE5","%E5":"\xE5","%e6":"\xE6","%E6":"\xE6","%e7":"\xE7","%E7":"\xE7","%e8":"\xE8","%E8":"\xE8","%e9":"\xE9","%E9":"\xE9","%ea":"\xEA","%Ea":"\xEA","%eA":"\xEA","%EA":"\xEA","%eb":"\xEB","%Eb":"\xEB","%eB":"\xEB","%EB":"\xEB","%ec":"\xEC","%Ec":"\xEC","%eC":"\xEC","%EC":"\xEC","%ed":"\xED","%Ed":"\xED","%eD":"\xED","%ED":"\xED","%ee":"\xEE","%Ee":"\xEE","%eE":"\xEE","%EE":"\xEE","%ef":"\xEF","%Ef":"\xEF","%eF":"\xEF","%EF":"\xEF","%f0":"\xF0","%F0":"\xF0","%f1":"\xF1","%F1":"\xF1","%f2":"\xF2","%F2":"\xF2","%f3":"\xF3","%F3":"\xF3","%f4":"\xF4","%F4":"\xF4","%f5":"\xF5","%F5":"\xF5","%f6":"\xF6","%F6":"\xF6","%f7":"\xF7","%F7":"\xF7","%f8":"\xF8","%F8":"\xF8","%f9":"\xF9","%F9":"\xF9","%fa":"\xFA","%Fa":"\xFA","%fA":"\xFA","%FA":"\xFA","%fb":"\xFB","%Fb":"\xFB","%fB":"\xFB","%FB":"\xFB","%fc":"\xFC","%Fc":"\xFC","%fC":"\xFC","%FC":"\xFC","%fd":"\xFD","%Fd":"\xFD","%fD":"\xFD","%FD":"\xFD","%fe":"\xFE","%Fe":"\xFE","%fE":"\xFE","%FE":"\xFE","%ff":"\xFF","%Ff":"\xFF","%fF":"\xFF","%FF":"\xFF"};function Ue(e){return Ot[e]}var V=0,je=1,he=2,We=3;function Nt(e){let t=[],i=V,s="",r=!1,n=!1,o=0,a="",f=e.length;for(var c=0;c<f;++c){let h=e[c];if(h==="\\"&&r)if(n)n=!1;else{n=!0;continue}else if(h==='"')if(n)n=!1;else{r?(r=!1,i=V):r=!0;continue}else if(n&&r&&(a+="\\"),n=!1,(i===he||i===We)&&h==="'"){i===he?(i=We,s=a.substring(1)):i=je,a="";continue}else if(i===V&&(h==="*"||h==="=")&&t.length){i=h==="*"?he:je,t[o]=[a,void 0],a="";continue}else if(!r&&h===";"){i=V,s?(a.length&&(a=G(a.replace(qe,Ue),"binary",s)),s=""):a.length&&(a=G(a,"binary","utf8")),t[o]===void 0?t[o]=a:t[o][1]=a,a="",++o;continue}else if(!r&&(h===" "||h==="	"))continue;a+=h}return s&&a.length?a=G(a.replace(qe,Ue),"binary",s):a&&(a=G(a,"binary","utf8")),t[o]===void 0?a&&(t[o]=a):t[o][1]=a,t}Ke.exports=Nt});var Ge=m((gi,$e)=>{"use strict";$e.exports=function(t){if(typeof t!="string")return"";for(var i=t.length-1;i>=0;--i)switch(t.charCodeAt(i)){case 47:case 92:return t=t.slice(i+1),t===".."||t==="."?"":t}return t===".."||t==="."?"":t}});var Ze=m((wi,Ye)=>{"use strict";var{Readable:Je}=require("node:stream"),{inherits:qt}=require("node:util"),Ut=fe(),Ve=de(),jt=$(),Wt=Ge(),k=K(),Kt=/^boundary$/i,$t=/^form-data$/i,Gt=/^charset$/i,Vt=/^filename$/i,Jt=/^name$/i;J.detect=/^multipart\/form-data/i;function J(e,t){let i,s,r=this,n,o=t.limits,a=t.isPartAFile||((P,p,_)=>p==="application/octet-stream"||_!==void 0),f=t.parsedConType||[],c=t.defCharset||"utf8",h=t.preservePath,b={highWaterMark:t.fileHwm};for(i=0,s=f.length;i<s;++i)if(Array.isArray(f[i])&&Kt.test(f[i][0])){n=f[i][1];break}function d(){R===0&&ee&&!e._done&&(ee=!1,r.end())}if(typeof n!="string")throw new Error("Multipart: Boundary not found");let u=k(o,"fieldSize",1*1024*1024),x=k(o,"fileSize",1/0),w=k(o,"files",1/0),F=k(o,"fields",1/0),X=k(o,"parts",1/0),Q=k(o,"headerPairs",2e3),ft=k(o,"headerSize",80*1024),_e=0,ye=0,R=0,I,O,ee=!1;this._needDrain=!1,this._pause=!1,this._cb=void 0,this._nparts=0,this._boy=e;let ct={boundary:n,maxHeaderPairs:Q,maxHeaderSize:ft,partHwm:b.highWaterMark,highWaterMark:t.highWaterMark};this.parser=new Ut(ct),this.parser.on("drain",function(){if(r._needDrain=!1,r._cb&&!r._pause){let P=r._cb;r._cb=void 0,P()}}).on("part",function P(p){if(++r._nparts>X)return r.parser.removeListener("part",P),r.parser.on("part",T),e.hitPartsLimit=!0,e.emit("partsLimit"),T(p);if(O){let _=O;_.emit("end"),_.removeAllListeners("end")}p.on("header",function(_){let S,N,y,q,U,v,M=0;if(_["content-type"]&&(y=Ve(_["content-type"][0]),y[0])){for(S=y[0].toLowerCase(),i=0,s=y.length;i<s;++i)if(Gt.test(y[i][0])){q=y[i][1].toLowerCase();break}}if(S===void 0&&(S="text/plain"),q===void 0&&(q=c),_["content-disposition"]){if(y=Ve(_["content-disposition"][0]),!$t.test(y[0]))return T(p);for(i=0,s=y.length;i<s;++i)Jt.test(y[i][0])?N=y[i][1]:Vt.test(y[i][0])&&(v=y[i][1],h||(v=Wt(v)))}else return T(p);_["content-transfer-encoding"]?U=_["content-transfer-encoding"][0].toLowerCase():U="7bit";let te,ie;if(a(N,S,v)){if(_e===w)return e.hitFilesLimit||(e.hitFilesLimit=!0,e.emit("filesLimit")),T(p);if(++_e,e.listenerCount("file")===0){r.parser._ignore();return}++R;let l=new le(b);I=l,l.on("end",function(){if(--R,r._pause=!1,d(),r._cb&&!r._needDrain){let E=r._cb;r._cb=void 0,E()}}),l._read=function(E){if(r._pause&&(r._pause=!1,r._cb&&!r._needDrain)){let C=r._cb;r._cb=void 0,C()}},e.emit("file",N,l,v,U,S),te=function(E){if((M+=E.length)>x){let C=x-M+E.length;C>0&&l.push(E.slice(0,C)),l.truncated=!0,l.bytesRead=x,p.removeAllListeners("data"),l.emit("limit");return}else l.push(E)||(r._pause=!0);l.bytesRead=M},ie=function(){I=void 0,l.push(null)}}else{if(ye===F)return e.hitFieldsLimit||(e.hitFieldsLimit=!0,e.emit("fieldsLimit")),T(p);++ye,++R;let l="",E=!1;O=p,te=function(C){if((M+=C.length)>u){let ht=u-(M-C.length);l+=C.toString("binary",0,ht),E=!0,p.removeAllListeners("data")}else l+=C.toString("binary")},ie=function(){O=void 0,l.length&&(l=jt(l,"binary",q)),e.emit("field",N,l,!1,E,U,S),--R,d()}}p._readableState.sync=!1,p.on("data",te),p.on("end",ie)}).on("error",function(_){I&&I.emit("error",_)})}).on("error",function(P){e.emit("error",P)}).on("finish",function(){ee=!0,d()})}J.prototype.write=function(e,t){let i=this.parser.write(e);i&&!this._pause?t():(this._needDrain=!i,this._cb=t)};J.prototype.end=function(){let e=this;e.parser.writable?e.parser.end():e._boy._done||process.nextTick(function(){e._boy._done=!0,e._boy.emit("finish")})};function T(e){e.resume()}function le(e){Je.call(this,e),this.bytesRead=0,this.truncated=!1}qt(le,Je);le.prototype._read=function(e){};Ye.exports=J});var Qe=m((Ei,Xe)=>{"use strict";var Yt=/\+/g,Zt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function ue(){this.buffer=void 0}ue.prototype.write=function(e){e=e.replace(Yt," ");let t="",i=0,s=0,r=e.length;for(;i<r;++i)this.buffer!==void 0?Zt[e.charCodeAt(i)]?(this.buffer+=e[i],++s,this.buffer.length===2&&(t+=String.fromCharCode(parseInt(this.buffer,16)),this.buffer=void 0)):(t+="%"+this.buffer,this.buffer=void 0,--i):e[i]==="%"&&(i>s&&(t+=e.substring(s,i),s=i),this.buffer="",++s);return s<r&&this.buffer===void 0&&(t+=e.substring(s)),t};ue.prototype.reset=function(){this.buffer=void 0};Xe.exports=ue});var tt=m((Ci,et)=>{"use strict";var Xt=Qe(),L=$(),xe=K(),Qt=/^charset$/i;Y.detect=/^application\/x-www-form-urlencoded/i;function Y(e,t){let i=t.limits,s=t.parsedConType;this.boy=e,this.fieldSizeLimit=xe(i,"fieldSize",1*1024*1024),this.fieldNameSizeLimit=xe(i,"fieldNameSize",100),this.fieldsLimit=xe(i,"fields",1/0);let r;for(var n=0,o=s.length;n<o;++n)if(Array.isArray(s[n])&&Qt.test(s[n][0])){r=s[n][1].toLowerCase();break}r===void 0&&(r=t.defCharset||"utf8"),this.decoder=new Xt,this.charset=r,this._fields=0,this._state="key",this._checkingBytes=!0,this._bytesKey=0,this._bytesVal=0,this._key="",this._val="",this._keyTrunc=!1,this._valTrunc=!1,this._hitLimit=!1}Y.prototype.write=function(e,t){if(this._fields===this.fieldsLimit)return this.boy.hitFieldsLimit||(this.boy.hitFieldsLimit=!0,this.boy.emit("fieldsLimit")),t();let i,s,r,n=0,o=e.length;for(;n<o;)if(this._state==="key"){for(i=s=void 0,r=n;r<o;++r){if(this._checkingBytes||++n,e[r]===61){i=r;break}else if(e[r]===38){s=r;break}if(this._checkingBytes&&this._bytesKey===this.fieldNameSizeLimit){this._hitLimit=!0;break}else this._checkingBytes&&++this._bytesKey}if(i!==void 0)i>n&&(this._key+=this.decoder.write(e.toString("binary",n,i))),this._state="val",this._hitLimit=!1,this._checkingBytes=!0,this._val="",this._bytesVal=0,this._valTrunc=!1,this.decoder.reset(),n=i+1;else if(s!==void 0){++this._fields;let a,f=this._keyTrunc;if(s>n?a=this._key+=this.decoder.write(e.toString("binary",n,s)):a=this._key,this._hitLimit=!1,this._checkingBytes=!0,this._key="",this._bytesKey=0,this._keyTrunc=!1,this.decoder.reset(),a.length&&this.boy.emit("field",L(a,"binary",this.charset),"",f,!1),n=s+1,this._fields===this.fieldsLimit)return t()}else this._hitLimit?(r>n&&(this._key+=this.decoder.write(e.toString("binary",n,r))),n=r,(this._bytesKey=this._key.length)===this.fieldNameSizeLimit&&(this._checkingBytes=!1,this._keyTrunc=!0)):(n<o&&(this._key+=this.decoder.write(e.toString("binary",n))),n=o)}else{for(s=void 0,r=n;r<o;++r){if(this._checkingBytes||++n,e[r]===38){s=r;break}if(this._checkingBytes&&this._bytesVal===this.fieldSizeLimit){this._hitLimit=!0;break}else this._checkingBytes&&++this._bytesVal}if(s!==void 0){if(++this._fields,s>n&&(this._val+=this.decoder.write(e.toString("binary",n,s))),this.boy.emit("field",L(this._key,"binary",this.charset),L(this._val,"binary",this.charset),this._keyTrunc,this._valTrunc),this._state="key",this._hitLimit=!1,this._checkingBytes=!0,this._key="",this._bytesKey=0,this._keyTrunc=!1,this.decoder.reset(),n=s+1,this._fields===this.fieldsLimit)return t()}else this._hitLimit?(r>n&&(this._val+=this.decoder.write(e.toString("binary",n,r))),n=r,(this._val===""&&this.fieldSizeLimit===0||(this._bytesVal=this._val.length)===this.fieldSizeLimit)&&(this._checkingBytes=!1,this._valTrunc=!0)):(n<o&&(this._val+=this.decoder.write(e.toString("binary",n))),n=o)}t()};Y.prototype.end=function(){this.boy._done||(this._state==="key"&&this._key.length>0?this.boy.emit("field",L(this._key,"binary",this.charset),"",this._keyTrunc,!1):this._state==="val"&&this.boy.emit("field",L(this._key,"binary",this.charset),L(this._val,"binary",this.charset),this._keyTrunc,this._valTrunc),this.boy._done=!0,this.boy.emit("finish"))};et.exports=Y});var rt=m((Ai,H)=>{"use strict";var pe=require("node:stream").Writable,{inherits:ei}=require("node:util"),ti=fe(),it=Ze(),st=tt(),ii=de();function A(e){if(!(this instanceof A))return new A(e);if(typeof e!="object")throw new TypeError("Busboy expected an options-Object.");if(typeof e.headers!="object")throw new TypeError("Busboy expected an options-Object with headers-attribute.");if(typeof e.headers["content-type"]!="string")throw new TypeError("Missing Content-Type-header.");let{headers:t,...i}=e;this.opts={autoDestroy:!1,...i},pe.call(this,this.opts),this._done=!1,this._parser=this.getParserByHeaders(t),this._finished=!1}ei(A,pe);A.prototype.emit=function(e){if(e==="finish"){if(this._done){if(this._finished)return}else{this._parser?.end();return}this._finished=!0}pe.prototype.emit.apply(this,arguments)};A.prototype.getParserByHeaders=function(e){let t=ii(e["content-type"]),i={defCharset:this.opts.defCharset,fileHwm:this.opts.fileHwm,headers:e,highWaterMark:this.opts.highWaterMark,isPartAFile:this.opts.isPartAFile,limits:this.opts.limits,parsedConType:t,preservePath:this.opts.preservePath};if(it.detect.test(t[0]))return new it(this,i);if(st.detect.test(t[0]))return new st(this,i);throw new Error("Unsupported Content-Type.")};A.prototype._write=function(e,t,i){this._parser.write(e,i)};H.exports=A;H.exports.default=A;H.exports.Busboy=A;H.exports.Dicer=ti});var di={};bt(di,{handler:()=>hi});module.exports=yt(di);var Ee=require("node:stream"),Ce=require("node:stream/promises"),Ae=require("node:stream/web"),Be=require("node:timers"),mt=()=>{},ge={timeoutEarlyInMillis:5,timeoutEarlyResponse:()=>{let e=new Error("[AbortError]: The operation was aborted.",{cause:{package:"@middy/core"}});throw e.name="TimeoutError",e},streamifyResponse:!1},gt=(e,t)=>{let i,s;typeof e=="function"?(i=e,s={...ge,...t}):(i=mt,s={...ge,...e}),s.timeoutEarly=s.timeoutEarlyInMillis>0,s.beforePrefetch?.();let r=[],n=[],o=[],a=(c={},h={})=>({event:c,context:h,response:void 0,error:void 0,internal:s.internal??{}}),f=s.streamifyResponse?awslambda.streamifyResponse(async(c,h,b)=>{let d=a(c,b);s.requestStart?.(d);let u=await we(d,r,i,n,o,s),x=h,w=u;if(u.statusCode){let{body:X,...Q}=u;w=X??"",x=awslambda.HttpResponseStream.from(x,Q)}let F;if(w._readableState||w instanceof Ae.ReadableStream?F=w:typeof w=="string"&&(F=Ee.Readable.from(w.length<re?w:wt(w))),!F)throw new Error("handler response not a ReadableStream");await(0,Ce.pipeline)(F,x),await s.requestEnd?.(d)}):async(c,h)=>{s.requestStart?.();let b=a(c,h),d=await we(b,r,i,n,o,s);return await s.requestEnd?.(b),d};return f.use=c=>{let h=Array.isArray(c)?c:[c];for(let b of h){let{before:d,after:u,onError:x}=b;if(d||u||x)d&&f.before(d),u&&f.after(u),x&&f.onError(x);else throw new Error('Middleware must be an object containing at least one key among "before", "after", "onError"')}return f},f.before=c=>(r.push(c),f),f.after=c=>(n.unshift(c),f),f.onError=c=>(o.unshift(c),f),f.handler=c=>(i=c,f),f},re=16384;function*wt(e){let t=0,i=e.length;for(;t<i;)yield e.substring(t,t+re),t+=re}var W=new AbortController,we=async(e,t,i,s,r,n)=>{let o,a=n.timeoutEarly&&e.context.getRemainingTimeInMillis;try{if(await se(e,t,n),!Object.prototype.hasOwnProperty.call(e,"earlyResponse")){n.beforeHandler?.(),W.signal.aborted&&(W=new AbortController);let f=[i(e.event,e.context,{signal:W.signal})];if(a){let c,h=new Promise((b,d)=>{c=()=>{W.abort();try{b(n.timeoutEarlyResponse())}catch(u){d(u)}}});o=(0,Be.setTimeout)(c,e.context.getRemainingTimeInMillis()-n.timeoutEarlyInMillis),f.push(h)}e.response=await Promise.race(f),o&&clearTimeout(o),n.afterHandler?.(),await se(e,s,n)}}catch(f){o&&clearTimeout(o),e.response=void 0,e.error=f;try{await se(e,r,n)}catch(c){throw c.originalError=e.error,e.error=c,e.error}if(typeof e.response>"u")throw e.error}return e.response},se=async(e,t,i)=>{for(let s of t){i.beforeMiddleware?.(s.name);let r=await s(e);if(i.afterMiddleware?.(s.name),typeof r<"u"&&(e.earlyResponse=r),Object.prototype.hasOwnProperty.call(e,"earlyResponse")){e.response=e.earlyResponse;return}}},ke=gt;var ot=_t(rt(),1);var si=/[^a-zA-Z]/g,be=class extends Error{constructor(t,i,s={}){let r=i,n=s;r&&typeof r!="string"&&(n=r,r=void 0),r??=nt[t],super(r,n);let o=nt[t].replace(si,"");this.name=o.substr(-5)!=="Error"?`${o}Error`:o,this.status=this.statusCode=t,this.expose=n.expose??t<500}},Z=(e,t,i={})=>new be(e,t,i),nt={100:"Continue",101:"Switching Protocols",102:"Processing",103:"Early Hints",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"(Unused)",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"};var ri=/^multipart\/form-data; boundary=[a-zA-Z0-9-]{1,70}(; ?[cC]harset=[\w-]+)?$/,ni=/(.+)\[(.*)]$/,oi={busboy:{},charset:"utf8",disableContentTypeError:!1},ai=(e={})=>{let t={...oi,...e};return{before:async s=>{let{headers:r,body:n}=s.event,o=r?.["content-type"]??r?.["Content-Type"];if(!ri.test(o)){if(t.disableContentTypeError)return;throw Z(415,"Unsupported Media Type",{cause:{package:"@middy/http-multipart-body-parser",data:o}})}if(typeof n>"u")throw Z(415,"Invalid or malformed multipart/form-data was provided",{cause:{package:"@middy/http-multipart-body-parser",data:n}});return fi(s.event,t).then(a=>{s.event.body=a}).catch(a=>{throw Z(415,"Invalid or malformed multipart/form-data was provided",{cause:{package:"@middy/http-multipart-body-parser",data:n,message:a.message}})})}}},fi=(e,t)=>{let i={},s=e.isBase64Encoded?"base64":t.charset,r=(0,ot.default)({...t.busboy,headers:{"content-type":e.headers?.["content-type"]??e.headers?.["Content-Type"]}});return new Promise((n,o)=>{r.on("file",(a,f,c,h,b)=>{let d={filename:c,mimetype:b,encoding:h},u=[];f.on("data",x=>{u.push(x)}),f.on("end",()=>{if(d.truncated=f.truncated,d.content=Buffer.concat(u),!i[a])i[a]=d;else{let x=i[a];i[a]=[d].concat(x)}})}).on("field",(a,f)=>{let c=a.match(ni);c?(i[c[1]]||(i[c[1]]=[]),i[c[1]].push(f)):i[a]=f}).on("finish",()=>n(i)).on("error",a=>o(a)),r.write(e.body,s),r.end()})},at=ai;var ci=async e=>{let t=e.body,i=Array.isArray(t.files)?t.files:[t.files];return{statusCode:200,body:JSON.stringify({message:"Parsed successfully",files:i.map(s=>({filename:s?.filename,contentType:s?.contentType,length:s?.content?.length}))})}},hi=ke(ci).use(at());0&&(module.exports={handler});
