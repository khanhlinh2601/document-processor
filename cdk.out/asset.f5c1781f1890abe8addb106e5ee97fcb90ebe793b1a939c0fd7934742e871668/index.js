var Me=Object.create;var U=Object.defineProperty;var Ue=Object.getOwnPropertyDescriptor;var Ke=Object.getOwnPropertyNames;var Fe=Object.getPrototypeOf,Ie=Object.prototype.hasOwnProperty;var A=(i,t)=>()=>(t||i((t={exports:{}}).exports,t),t.exports),Re=(i,t)=>{for(var r in t)U(i,r,{get:t[r],enumerable:!0})},se=(i,t,r,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Ke(t))!Ie.call(i,n)&&n!==r&&U(i,n,{get:()=>t[n],enumerable:!(e=Ue(t,n))||e.enumerable});return i};var De=(i,t,r)=>(r=i!=null?Me(Fe(i)):{},se(t||!i||!i.__esModule?U(r,"default",{value:i,enumerable:!0}):r,i)),Ne=i=>se(U({},"__esModule",{value:!0}),i);var R=A((he,ce)=>{"use strict";function Oe(i){if(i.length===0)return;let t=Object.create(null),r=0;for(;r<i.length;++r){let o=i.charCodeAt(r);if(P[o]!==1){if(o!==47||r===0)return;break}}if(r===i.length)return;let e=i.slice(0,r).toLowerCase(),n=++r;for(;r<i.length;++r){let o=i.charCodeAt(r);if(P[o]!==1){if(r===n||Ve(i,r,t)===void 0)return;break}}if(r===n)return;let s=i.slice(n,r).toLowerCase();return{type:e,subtype:s,params:t}}function Ve(i,t,r){for(;t<i.length;){for(;t<i.length;++t){let a=i.charCodeAt(t);if(a!==32&&a!==9)break}if(t===i.length)break;if(i.charCodeAt(t++)!==59)return;for(;t<i.length;++t){let a=i.charCodeAt(t);if(a!==32&&a!==9)break}if(t===i.length)return;let e,n=t;for(;t<i.length;++t){let a=i.charCodeAt(t);if(P[a]!==1){if(a!==61)return;break}}if(t===i.length||(e=i.slice(n,t),++t,t===i.length))return;let s="",o;if(i.charCodeAt(t)===34){o=++t;let a=!1;for(;t<i.length;++t){let f=i.charCodeAt(t);if(f===92){a?(o=t,a=!1):(s+=i.slice(o,t),a=!0);continue}if(f===34){if(a){o=t,a=!1;continue}s+=i.slice(o,t);break}if(a&&(o=t-1,a=!1),fe[f]!==1)return}if(t===i.length)return;++t}else{for(o=t;t<i.length;++t){let a=i.charCodeAt(t);if(P[a]!==1){if(t===o)return;break}}s=i.slice(o,t)}e=e.toLowerCase(),r[e]===void 0&&(r[e]=s)}return r}function We(i,t){if(i.length===0)return;let r=Object.create(null),e=0;for(;e<i.length;++e){let s=i.charCodeAt(e);if(P[s]!==1){if(He(i,e,r,t)===void 0)return;break}}return{type:i.slice(0,e).toLowerCase(),params:r}}function He(i,t,r,e){for(;t<i.length;){for(;t<i.length;++t){let h=i.charCodeAt(t);if(h!==32&&h!==9)break}if(t===i.length)break;if(i.charCodeAt(t++)!==59)return;for(;t<i.length;++t){let h=i.charCodeAt(t);if(h!==32&&h!==9)break}if(t===i.length)return;let n,s=t;for(;t<i.length;++t){let h=i.charCodeAt(t);if(P[h]!==1){if(h===61)break;return}}if(t===i.length)return;let o="",a,f;if(n=i.slice(s,t),n.charCodeAt(n.length-1)===42){let h=++t;for(;t<i.length;++t){let m=i.charCodeAt(t);if($e[m]!==1){if(m!==39)return;break}}if(t===i.length)return;for(f=i.slice(h,t),++t;t<i.length&&i.charCodeAt(t)!==39;++t);if(t===i.length||(++t,t===i.length))return;a=t;let u=0;for(;t<i.length;++t){let m=i.charCodeAt(t);if(Ge[m]!==1){if(m===37){let d,b;if(t+2<i.length&&(d=oe[i.charCodeAt(t+1)])!==-1&&(b=oe[i.charCodeAt(t+2)])!==-1){let T=(d<<4)+b;o+=i.slice(a,t),o+=String.fromCharCode(T),t+=2,a=t+1,T>=128?u=2:u===0&&(u=1);continue}return}break}}if(o+=i.slice(a,t),o=le(o,f,u),o===void 0)return}else{if(++t,t===i.length)return;if(i.charCodeAt(t)===34){a=++t;let h=!1;for(;t<i.length;++t){let u=i.charCodeAt(t);if(u===92){h?(a=t,h=!1):(o+=i.slice(a,t),h=!0);continue}if(u===34){if(h){a=t,h=!1;continue}o+=i.slice(a,t);break}if(h&&(a=t-1,h=!1),fe[u]!==1)return}if(t===i.length)return;++t}else{for(a=t;t<i.length;++t){let h=i.charCodeAt(t);if(P[h]!==1){if(t===a)return;break}}o=i.slice(a,t)}if(o=e(o,2),o===void 0)return}n=n.toLowerCase(),r[n]===void 0&&(r[n]=o)}return r}function ae(i){let t;for(;;)switch(i){case"utf-8":case"utf8":return x.utf8;case"latin1":case"ascii":case"us-ascii":case"iso-8859-1":case"iso8859-1":case"iso88591":case"iso_8859-1":case"windows-1252":case"iso_8859-1:1987":case"cp1252":case"x-cp1252":return x.latin1;case"utf16le":case"utf-16le":case"ucs2":case"ucs-2":return x.utf16le;case"base64":return x.base64;default:if(t===void 0){t=!0,i=i.toLowerCase();continue}return x.other.bind(i)}}var x={utf8:(i,t)=>{if(i.length===0)return"";if(typeof i=="string"){if(t<2)return i;i=Buffer.from(i,"latin1")}return i.utf8Slice(0,i.length)},latin1:(i,t)=>i.length===0?"":typeof i=="string"?i:i.latin1Slice(0,i.length),utf16le:(i,t)=>i.length===0?"":(typeof i=="string"&&(i=Buffer.from(i,"latin1")),i.ucs2Slice(0,i.length)),base64:(i,t)=>i.length===0?"":(typeof i=="string"&&(i=Buffer.from(i,"latin1")),i.base64Slice(0,i.length)),other:(i,t)=>{if(i.length===0)return"";typeof i=="string"&&(i=Buffer.from(i,"latin1"));try{return new TextDecoder(he).decode(i)}catch{}}};function le(i,t,r){let e=ae(t);if(e)return e(i,r)}function qe(i){if(typeof i!="string")return"";for(let t=i.length-1;t>=0;--t)switch(i.charCodeAt(t)){case 47:case 92:return i=i.slice(t+1),i===".."||i==="."?"":i}return i===".."||i==="."?"":i}var P=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],fe=[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],$e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,0,0,0,0,1,0,1,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Ge=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],oe=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];ce.exports={basename:qe,convertToUTF8:le,getDecoder:ae,parseContentType:Oe,parseDisposition:We}});var me=A((k1,_e)=>{"use strict";function ue(i,t,r,e,n){for(let s=0;s<n;++s)if(i[t+s]!==r[e+s])return!1;return!0}var H=class{constructor(t,r){if(typeof r!="function")throw new Error("Missing match callback");if(typeof t=="string")t=Buffer.from(t);else if(!Buffer.isBuffer(t))throw new Error(`Expected Buffer for needle, got ${typeof t}`);let e=t.length;if(this.maxMatches=1/0,this.matches=0,this._cb=r,this._lookbehindSize=0,this._needle=t,this._bufPos=0,this._lookbehind=Buffer.allocUnsafe(e),this._occ=[e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e],e>1)for(let n=0;n<e-1;++n)this._occ[t[n]]=e-1-n}reset(){this.matches=0,this._lookbehindSize=0,this._bufPos=0}push(t,r){let e;Buffer.isBuffer(t)||(t=Buffer.from(t,"latin1"));let n=t.length;for(this._bufPos=r||0;e!==n&&this.matches<this.maxMatches;)e=je(this,t);return e}destroy(){let t=this._lookbehindSize;t&&this._cb(!1,this._lookbehind,0,t,!1),this.reset()}};function je(i,t){let r=t.length,e=i._needle,n=e.length,s=-i._lookbehindSize,o=n-1,a=e[o],f=r-n,h=i._occ,u=i._lookbehind;if(s<0){for(;s<0&&s<=f;){let d=s+o,b=d<0?u[i._lookbehindSize+d]:t[d];if(b===a&&de(i,t,s,o))return i._lookbehindSize=0,++i.matches,s>-i._lookbehindSize?i._cb(!0,u,0,i._lookbehindSize+s,!1):i._cb(!0,void 0,0,0,!0),i._bufPos=s+n;s+=h[b]}for(;s<0&&!de(i,t,s,r-s);)++s;if(s<0){let d=i._lookbehindSize+s;return d>0&&i._cb(!1,u,0,d,!1),i._lookbehindSize-=d,u.copy(u,0,d,i._lookbehindSize),u.set(t,i._lookbehindSize),i._lookbehindSize+=r,i._bufPos=r,r}i._cb(!1,u,0,i._lookbehindSize,!1),i._lookbehindSize=0}s+=i._bufPos;let m=e[0];for(;s<=f;){let d=t[s+o];if(d===a&&t[s]===m&&ue(e,0,t,s,o))return++i.matches,s>0?i._cb(!0,t,i._bufPos,s,!0):i._cb(!0,void 0,0,0,!0),i._bufPos=s+n;s+=h[d]}for(;s<r;){if(t[s]!==m||!ue(t,s,e,0,r-s)){++s;continue}t.copy(u,0,s,r),i._lookbehindSize=r-s;break}return s>0&&i._cb(!1,t,i._bufPos,s<r?s:r,!0),i._bufPos=r,r}function de(i,t,r,e){let n=i._lookbehind,s=i._lookbehindSize,o=i._needle;for(let a=0;a<e;++a,++r)if((r<0?n[s+r]:t[r])!==o[a])return!1;return!0}_e.exports=H});var ke=A((E1,Pe)=>{"use strict";var{Readable:Xe,Writable:Je}=require("stream"),Qe=me(),{basename:Ye,convertToUTF8:ye,getDecoder:Ze,parseContentType:e1,parseDisposition:t1}=R(),i1=Buffer.from(`\r
`),r1=Buffer.from("\r"),n1=Buffer.from("-");function be(){}var s1=2e3,E=16*1024,D=0,pe=1,we=2,q=class{constructor(t){this.header=Object.create(null),this.pairCount=0,this.byteCount=0,this.state=D,this.name="",this.value="",this.crlf=0,this.cb=t}reset(){this.header=Object.create(null),this.pairCount=0,this.byteCount=0,this.state=D,this.name="",this.value="",this.crlf=0}push(t,r,e){let n=r;for(;r<e;)switch(this.state){case D:{let s=!1;for(;r<e;++r){if(this.byteCount===E)return-1;++this.byteCount;let o=t[r];if(l1[o]!==1){if(o!==58||(this.name+=t.latin1Slice(n,r),this.name.length===0))return-1;++r,s=!0,this.state=pe;break}}if(!s){this.name+=t.latin1Slice(n,r);break}}case pe:{let s=!1;for(;r<e;++r){if(this.byteCount===E)return-1;++this.byteCount;let o=t[r];if(o!==32&&o!==9){n=r,s=!0,this.state=we;break}}if(!s)break}case we:switch(this.crlf){case 0:for(;r<e;++r){if(this.byteCount===E)return-1;++this.byteCount;let s=t[r];if(f1[s]!==1){if(s!==13)return-1;++this.crlf;break}}this.value+=t.latin1Slice(n,r++);break;case 1:if(this.byteCount===E||(++this.byteCount,t[r++]!==10))return-1;++this.crlf;break;case 2:{if(this.byteCount===E)return-1;++this.byteCount;let s=t[r];s===32||s===9?(n=r,this.crlf=0):(++this.pairCount<s1&&(this.name=this.name.toLowerCase(),this.header[this.name]===void 0?this.header[this.name]=[this.value]:this.header[this.name].push(this.value)),s===13?(++this.crlf,++r):(n=r,this.crlf=0,this.state=D,this.name="",this.value=""));break}case 3:{if(this.byteCount===E||(++this.byteCount,t[r++]!==10))return-1;let s=this.header;return this.reset(),this.cb(s),r}}break}return r}},$=class extends Xe{constructor(t,r){super(t),this.truncated=!1,this._readcb=null,this.once("end",()=>{if(this._read(),--r._fileEndsLeft===0&&r._finalcb){let e=r._finalcb;r._finalcb=null,process.nextTick(e)}})}_read(t){let r=this._readcb;r&&(this._readcb=null,r())}},Ce={push:(i,t)=>{},destroy:()=>{}};function o1(i,t){let r=i._writecb;i._writecb=null,t?i.destroy(t):r&&r()}function a1(i,t){return i}var G=class extends Je{constructor(t){let r={autoDestroy:!0,emitClose:!0,highWaterMark:typeof t.highWaterMark=="number"?t.highWaterMark:void 0};if(super(r),!t.conType.params||typeof t.conType.params.boundary!="string")throw new Error("Multipart: Boundary not found");let e=t.conType.params.boundary,n=typeof t.defParamCharset=="string"&&t.defParamCharset?Ze(t.defParamCharset):a1,s=t.defCharset||"utf8",o=t.preservePath,a={autoDestroy:!0,emitClose:!0,highWaterMark:typeof t.fileHwm=="number"?t.fileHwm:void 0},f=t.limits,h=f&&typeof f.fieldSize=="number"?f.fieldSize:1*1024*1024,u=f&&typeof f.fileSize=="number"?f.fileSize:1/0,m=f&&typeof f.files=="number"?f.files:1/0,d=f&&typeof f.fields=="number"?f.fields:1/0,b=f&&typeof f.parts=="number"?f.parts:1/0,T=-1,Z=0,ee=0,p=!1;this._fileEndsLeft=0,this._fileStream=void 0,this._complete=!1;let L=0,C,k=0,z,B,v,M,O=!1,te=!1,ie=!1;this._hparser=null;let re=new q(S=>{this._hparser=null,p=!1,v="text/plain",z=s,B="7bit",M=void 0,O=!1;let _;if(!S["content-disposition"]){p=!0;return}let l=t1(S["content-disposition"][0],n);if(!l||l.type!=="form-data"){p=!0;return}if(l.params&&(l.params.name&&(M=l.params.name),l.params["filename*"]?_=l.params["filename*"]:l.params.filename&&(_=l.params.filename),_!==void 0&&!o&&(_=Ye(_))),S["content-type"]){let y=e1(S["content-type"][0]);y&&(v=`${y.type}/${y.subtype}`,y.params&&typeof y.params.charset=="string"&&(z=y.params.charset.toLowerCase()))}if(S["content-transfer-encoding"]&&(B=S["content-transfer-encoding"][0].toLowerCase()),v==="application/octet-stream"||_!==void 0){if(ee===m){te||(te=!0,this.emit("filesLimit")),p=!0;return}if(++ee,this.listenerCount("file")===0){p=!0;return}L=0,this._fileStream=new $(a,this),++this._fileEndsLeft,this.emit("file",M,this._fileStream,{filename:_,encoding:B,mimeType:v})}else{if(Z===d){ie||(ie=!0,this.emit("fieldsLimit")),p=!0;return}if(++Z,this.listenerCount("field")===0){p=!0;return}C=[],k=0}}),w=0,V=(S,_,l,y,ne)=>{e:for(;_;){if(this._hparser!==null){let c=this._hparser.push(_,l,y);if(c===-1){this._hparser=null,re.reset(),this.emit("error",new Error("Malformed part header"));break}l=c}if(l===y)break;if(w!==0){if(w===1){switch(_[l]){case 45:w=2,++l;break;case 13:w=3,++l;break;default:w=0}if(l===y)return}if(w===2){if(w=0,_[l]===45){this._complete=!0,this._bparser=Ce;return}let c=this._writecb;this._writecb=be,V(!1,n1,0,1,!1),this._writecb=c}else if(w===3)if(w=0,_[l]===10){if(++l,T>=b||(this._hparser=re,l===y))break;continue e}else{let c=this._writecb;this._writecb=be,V(!1,r1,0,1,!1),this._writecb=c}}if(!p){if(this._fileStream){let c,g=Math.min(y-l,u-L);ne?c=_.slice(l,l+g):(c=Buffer.allocUnsafe(g),_.copy(c,0,l,l+g)),L+=c.length,L===u?(c.length>0&&this._fileStream.push(c),this._fileStream.emit("limit"),this._fileStream.truncated=!0,p=!0):this._fileStream.push(c)||(this._writecb&&(this._fileStream._readcb=this._writecb),this._writecb=null)}else if(C!==void 0){let c,g=Math.min(y-l,h-k);ne?c=_.slice(l,l+g):(c=Buffer.allocUnsafe(g),_.copy(c,0,l,l+g)),k+=g,C.push(c),k===h&&(p=!0,O=!0)}}break}if(S){if(w=1,this._fileStream)this._fileStream.push(null),this._fileStream=null;else if(C!==void 0){let c;switch(C.length){case 0:c="";break;case 1:c=ye(C[0],z,0);break;default:c=ye(Buffer.concat(C,k),z,0)}C=void 0,k=0,this.emit("field",M,c,{nameTruncated:!1,valueTruncated:O,encoding:B,mimeType:v})}++T===b&&this.emit("partsLimit")}};this._bparser=new Qe(`\r
--${e}`,V),this._writecb=null,this._finalcb=null,this.write(i1)}static detect(t){return t.type==="multipart"&&t.subtype==="form-data"}_write(t,r,e){this._writecb=e,this._bparser.push(t,0),this._writecb&&o1(this)}_destroy(t,r){this._hparser=null,this._bparser=Ce,t||(t=ge(this));let e=this._fileStream;e&&(this._fileStream=null,e.destroy(t)),r(t)}_final(t){if(this._bparser.destroy(),!this._complete)return t(new Error("Unexpected end of form"));this._fileEndsLeft?this._finalcb=Se.bind(null,this,t):Se(this,t)}};function Se(i,t,r){if(r)return t(r);r=ge(i),t(r)}function ge(i){if(i._hparser)return new Error("Malformed part header");let t=i._fileStream;if(t&&(i._fileStream=null,t.destroy(new Error("Unexpected end of file"))),!i._complete)return new Error("Unexpected end of form")}var l1=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],f1=[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];Pe.exports=G});var Te=A((T1,Ee)=>{"use strict";var{Writable:h1}=require("stream"),{getDecoder:c1}=R(),Y=class extends h1{constructor(t){let r={autoDestroy:!0,emitClose:!0,highWaterMark:typeof t.highWaterMark=="number"?t.highWaterMark:void 0};super(r);let e=t.defCharset||"utf8";t.conType.params&&typeof t.conType.params.charset=="string"&&(e=t.conType.params.charset),this.charset=e;let n=t.limits;this.fieldSizeLimit=n&&typeof n.fieldSize=="number"?n.fieldSize:1*1024*1024,this.fieldsLimit=n&&typeof n.fields=="number"?n.fields:1/0,this.fieldNameSizeLimit=n&&typeof n.fieldNameSize=="number"?n.fieldNameSize:100,this._inKey=!0,this._keyTrunc=!1,this._valTrunc=!1,this._bytesKey=0,this._bytesVal=0,this._fields=0,this._key="",this._val="",this._byte=-2,this._lastPos=0,this._encode=0,this._decoder=c1(e)}static detect(t){return t.type==="application"&&t.subtype==="x-www-form-urlencoded"}_write(t,r,e){if(this._fields>=this.fieldsLimit)return e();let n=0,s=t.length;if(this._lastPos=0,this._byte!==-2){if(n=j(this,t,n,s),n===-1)return e(new Error("Malformed urlencoded form"));if(n>=s)return e();this._inKey?++this._bytesKey:++this._bytesVal}e:for(;n<s;)if(this._inKey){for(n=X(this,t,n,s);n<s;){switch(t[n]){case 61:this._lastPos<n&&(this._key+=t.latin1Slice(this._lastPos,n)),this._lastPos=++n,this._key=this._decoder(this._key,this._encode),this._encode=0,this._inKey=!1;continue e;case 38:if(this._lastPos<n&&(this._key+=t.latin1Slice(this._lastPos,n)),this._lastPos=++n,this._key=this._decoder(this._key,this._encode),this._encode=0,this._bytesKey>0&&this.emit("field",this._key,"",{nameTruncated:this._keyTrunc,valueTruncated:!1,encoding:this.charset,mimeType:"text/plain"}),this._key="",this._val="",this._keyTrunc=!1,this._valTrunc=!1,this._bytesKey=0,this._bytesVal=0,++this._fields>=this.fieldsLimit)return this.emit("fieldsLimit"),e();continue;case 43:this._lastPos<n&&(this._key+=t.latin1Slice(this._lastPos,n)),this._key+=" ",this._lastPos=n+1;break;case 37:if(this._encode===0&&(this._encode=1),this._lastPos<n&&(this._key+=t.latin1Slice(this._lastPos,n)),this._lastPos=n+1,this._byte=-1,n=j(this,t,n+1,s),n===-1)return e(new Error("Malformed urlencoded form"));if(n>=s)return e();++this._bytesKey,n=X(this,t,n,s);continue}++n,++this._bytesKey,n=X(this,t,n,s)}this._lastPos<n&&(this._key+=t.latin1Slice(this._lastPos,n))}else{for(n=J(this,t,n,s);n<s;){switch(t[n]){case 38:if(this._lastPos<n&&(this._val+=t.latin1Slice(this._lastPos,n)),this._lastPos=++n,this._inKey=!0,this._val=this._decoder(this._val,this._encode),this._encode=0,(this._bytesKey>0||this._bytesVal>0)&&this.emit("field",this._key,this._val,{nameTruncated:this._keyTrunc,valueTruncated:this._valTrunc,encoding:this.charset,mimeType:"text/plain"}),this._key="",this._val="",this._keyTrunc=!1,this._valTrunc=!1,this._bytesKey=0,this._bytesVal=0,++this._fields>=this.fieldsLimit)return this.emit("fieldsLimit"),e();continue e;case 43:this._lastPos<n&&(this._val+=t.latin1Slice(this._lastPos,n)),this._val+=" ",this._lastPos=n+1;break;case 37:if(this._encode===0&&(this._encode=1),this._lastPos<n&&(this._val+=t.latin1Slice(this._lastPos,n)),this._lastPos=n+1,this._byte=-1,n=j(this,t,n+1,s),n===-1)return e(new Error("Malformed urlencoded form"));if(n>=s)return e();++this._bytesVal,n=J(this,t,n,s);continue}++n,++this._bytesVal,n=J(this,t,n,s)}this._lastPos<n&&(this._val+=t.latin1Slice(this._lastPos,n))}e()}_final(t){if(this._byte!==-2)return t(new Error("Malformed urlencoded form"));(!this._inKey||this._bytesKey>0||this._bytesVal>0)&&(this._inKey?this._key=this._decoder(this._key,this._encode):this._val=this._decoder(this._val,this._encode),this.emit("field",this._key,this._val,{nameTruncated:this._keyTrunc,valueTruncated:this._valTrunc,encoding:this.charset,mimeType:"text/plain"})),t()}};function j(i,t,r,e){if(r>=e)return e;if(i._byte===-1){let n=Q[t[r++]];if(n===-1)return-1;if(n>=8&&(i._encode=2),r<e){let s=Q[t[r++]];if(s===-1)return-1;i._inKey?i._key+=String.fromCharCode((n<<4)+s):i._val+=String.fromCharCode((n<<4)+s),i._byte=-2,i._lastPos=r}else i._byte=n}else{let n=Q[t[r++]];if(n===-1)return-1;i._inKey?i._key+=String.fromCharCode((i._byte<<4)+n):i._val+=String.fromCharCode((i._byte<<4)+n),i._byte=-2,i._lastPos=r}return r}function X(i,t,r,e){if(i._bytesKey>i.fieldNameSizeLimit){for(i._keyTrunc||i._lastPos<r&&(i._key+=t.latin1Slice(i._lastPos,r-1)),i._keyTrunc=!0;r<e;++r){let n=t[r];if(n===61||n===38)break;++i._bytesKey}i._lastPos=r}return r}function J(i,t,r,e){if(i._bytesVal>i.fieldSizeLimit){for(i._valTrunc||i._lastPos<r&&(i._val+=t.latin1Slice(i._lastPos,r-1)),i._valTrunc=!0;r<e&&t[r]!==38;++r)++i._bytesVal;i._lastPos=r}return r}var Q=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];Ee.exports=Y});var Ae=A((v1,ve)=>{"use strict";var{parseContentType:u1}=R();function d1(i){let t=i.headers,r=u1(t["content-type"]);if(!r)throw new Error("Malformed content type");for(let e of _1){if(!e.detect(r))continue;let s={limits:i.limits,headers:t,conType:r,highWaterMark:void 0,fileHwm:void 0,defCharset:void 0,defParamCharset:void 0,preservePath:!1};return i.highWaterMark&&(s.highWaterMark=i.highWaterMark),i.fileHwm&&(s.fileHwm=i.fileHwm),s.defCharset=i.defCharset,s.defParamCharset=i.defParamCharset,s.preservePath=i.preservePath,new e(s)}throw new Error(`Unsupported content type: ${t["content-type"]}`)}var _1=[ke(),Te()].filter(function(i){return typeof i.detect=="function"});ve.exports=i=>{if((typeof i!="object"||i===null)&&(i={}),typeof i.headers!="object"||i.headers===null||typeof i.headers["content-type"]!="string")throw new Error("Missing Content-Type");return d1(i)}});var p1={};Re(p1,{handler:()=>b1});module.exports=Ne(p1);var K=class{constructor(t){this.uploader=t}async execute(t){let r=[];for(let e of t){let n=await this.uploader.upload(e);r.push(n)}return r}};var I=require("@aws-sdk/client-s3");function W(i){let t=process.env[i];if(!t)throw new Error(`Missing env var: ${i}`);return t}var F=class{constructor(){this.s3=new I.S3Client({region:W("AWS_REGION")}),this.bucket=W("S3_BUCKET")}async upload(t){let r=`${Date.now()}-${t.filename}`;return await this.s3.send(new I.PutObjectCommand({Bucket:this.bucket,Key:r,Body:t.content,ContentType:t.mimetype})),`https://${this.bucket}.s3.amazonaws.com/${r}`}};var xe=De(Ae()),Le=require("stream");function ze(i){return new Promise((t,r)=>{let e=i.headers["content-type"]||i.headers["Content-Type"];if(!e?.startsWith("multipart/form-data"))return r(new Error("Invalid content-type, expected multipart/form-data"));let n=i.isBase64Encoded?Buffer.from(i.body||"","base64"):Buffer.from(i.body||"","utf8"),s=[],o=new xe.default({headers:{"content-type":e}});o.on("file",(a,f,h,u,m)=>{let d=[];f.on("data",b=>d.push(b)),f.on("end",()=>{s.push({fieldname:a,filename:h,contentType:m,content:Buffer.concat(d)})})}),o.on("error",r),o.on("finish",()=>t(s)),Le.Readable.from(n).pipe(o)})}var N=class{constructor({filename:t,content:r,mimetype:e,size:n}){this.filename=t,this.content=r,this.mimetype=e,this.size=n,this.validate()}validate(){if(!this.filename)throw new Error("Filename is required");if(!this.content||!(this.content instanceof Buffer))throw new Error("Content must be a Buffer");if(!this.mimetype)throw new Error("Mimetype is required");if(this.size>10*1024*1024)throw new Error("File size exceeds 10MB")}};var Be={info:(...i)=>console.log("[INFO]",...i),error:(...i)=>console.error("[ERROR]",...i)};var m1=new F,y1=new K(m1),b1=async i=>{try{let r=(await ze(i)).map(n=>new N(n)),e=await y1.execute(r);return{statusCode:200,body:JSON.stringify({urls:e})}}catch(t){return Be.error("Upload failed",t),{statusCode:500,body:JSON.stringify({message:"Upload failed",error:t.message})}}};0&&(module.exports={handler});
